{"ast":null,"code":"import cheerio from 'cheerio';\nimport { GetChannelJson, GetVideoJson, GetStatsJson, GetUserJson } from \"../connector/\";\n\nconst _liConverterToJson = async body => {\n  const $ = await cheerio.load(body);\n  const items = $('li').toArray();\n  return Promise.all(await items.map(async item => {\n    const videoId = $(item).attr('id').replace(\"clip\", \"\");\n    return await GetVideo(videoId);\n  }));\n};\n\nconst GetVideo = async videoId => {\n  const videoBody = await GetVideoJson(videoId);\n  const statsJson = await GetStatsJson(videoId);\n  const initScript = videoBody.split('<script type=\"application/ld+json\">')[1];\n  const data = initScript.split('</script>')[0].trim();\n  const json = JSON.parse(data)[0];\n  const videoJson = {\n    videoId,\n    \"thumbnail\": [json.thumbnailUrl],\n    \"title\": json.name,\n    \"description\": json.description,\n    \"publishedTimeText\": json.uploadDate,\n    \"viewCountText\": JSON.parse(statsJson).total_plays.raw\n  };\n  return videoJson;\n};\n\nconst GetDataChannel = async channel => {\n  const tabs = await GetChannelJson(channel);\n  const $ = cheerio.load(tabs);\n  const ol = $('#clips');\n  const json = await _liConverterToJson(ol.html());\n  const owner = $('.owner').text(); //return $('.owner')\n\n  return $('.portrait').text(); //return json;\n};\n\nconst GetUser = async userId => {\n  const userText = await GetUserJson(userId);\n  const videosText = userText.split('vimeo.config = _extend((vimeo.config || {}),')[1].split(\"var __i18nLocale\")[0].trim().slice(0, -2);\n  const userJson = await JSON.parse(videosText);\n  const clipsJson = userJson.profile.initial_state.clips;\n  const userVideosJson = await clipsJson.map(async clip => await GetVideo(clip.clip_id));\n  const {\n    display_name,\n    url,\n    location,\n    sm_portrait\n  } = userJson.profile.app_config.user;\n  return {\n    user: {\n      name: display_name,\n      url,\n      location,\n      photo: sm_portrait\n    },\n    videos: await Promise.all(userVideosJson)\n  };\n};\n\nexport { GetDataChannel, GetVideo, GetUser };","map":{"version":3,"sources":["/home/noct/Trabalho/my-git/reactjs-nodejs-deck/src/services/vimeo/facade/vimeo.facade.ts"],"names":["cheerio","GetChannelJson","GetVideoJson","GetStatsJson","GetUserJson","_liConverterToJson","body","$","load","items","toArray","Promise","all","map","item","videoId","attr","replace","GetVideo","videoBody","statsJson","initScript","split","data","trim","json","JSON","parse","videoJson","thumbnailUrl","name","description","uploadDate","total_plays","raw","GetDataChannel","channel","tabs","ol","html","owner","text","GetUser","userId","userText","videosText","slice","userJson","clipsJson","profile","initial_state","clips","userVideosJson","clip","clip_id","display_name","url","location","sm_portrait","app_config","user","photo","videos"],"mappings":"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","sourcesContent":["import cheerio from 'cheerio'\nimport {GetChannelJson, GetVideoJson, GetStatsJson, GetUserJson} from \"../connector/\";\n\nconst _liConverterToJson = async body => { \n    const $ = await cheerio.load(body)\n    const items = $('li').toArray();\n    return Promise.all(await items.map(async item => {\n        const videoId = $(item).attr('id').replace(\"clip\",\"\");\n        return await GetVideo(videoId);\n    }));\n\n};\n\n\nconst GetVideo = async videoId => {\n    const videoBody = await GetVideoJson(videoId);\n    const statsJson = await GetStatsJson(videoId);\n    const initScript = videoBody.split('<script type=\"application/ld+json\">')[1];\n    const data = initScript.split('</script>')[0].trim();\n    const json = JSON.parse(data)[0];\n    const videoJson = {\n          videoId,\n          \"thumbnail\" : [json.thumbnailUrl],\n          \"title\" : json.name,\n          \"description\" : json.description,\n          \"publishedTimeText\" : json.uploadDate,\n          \"viewCountText\" : JSON.parse(statsJson).total_plays.raw,\n    }\n    return videoJson;\n};\n\n\nconst GetDataChannel = async channel => {\n  const tabs = await GetChannelJson(channel);\n  const $ = cheerio.load(tabs)\n  const ol = $('#clips');\n  const json = await _liConverterToJson(ol.html());\n  const owner = $('.owner').text();\n\n  //return $('.owner')\n  return $('.portrait').text()\n  //return json;\n}\n\n\nconst GetUser = async userId => {\n    const userText = await GetUserJson(userId);\n\n    const videosText = userText\n        .split('vimeo.config = _extend((vimeo.config || {}),')[1]\n        .split(\"var __i18nLocale\")[0]\n        .trim()\n        .slice(0,-2)\n    const userJson = await JSON.parse(videosText);\n    const clipsJson = userJson.profile.initial_state.clips;\n    const userVideosJson = await clipsJson.map(async clip =>  await GetVideo(clip.clip_id))\n    const { display_name, url, location, sm_portrait} = userJson.profile.app_config.user;\n    return {\n        user: {\n            name: display_name,\n            url,\n            location,\n            photo: sm_portrait\n        },\n        videos: await Promise.all(userVideosJson)\n    }\n}\n\n\nexport { GetDataChannel, GetVideo, GetUser };\n"]},"metadata":{},"sourceType":"module"}